---
apiVersion: v1
kind: Secret
metadata:
  name: in-cluster
  namespace: argocd
  labels:
    # argocd.argoproj.io/secret-type: cluster # add this to any new cluster Secret
    app.o1labs.org/kubernetes-dashboard: enabled
    app.o1labs.org/external-dns: enabled
    app.o1labs.org/external-secrets-operator: enabled
    app.o1labs.org/kube-prometheus: enabled
    argocd.argoproj.io/secret-type: cluster
stringData:
  name: in-cluster
  server: https://kubernetes.default.svc
  config: |
    {
      "tlsClientConfig": {
        "insecure": false
      }
    }
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: buildkite-infra-central1
  namespace: argocd
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: gcp-store
  target:
    creationPolicy: Owner
    deletionPolicy: Retain
    name: buildkite-infra-central1
    template:
      engineVersion: v2
      metadata:
        labels:
          argocd.argoproj.io/secret-type: cluster
          app.o1labs.org/kubernetes-dashboard: enabled
          # app.o1labs.org/external-dns: enabled # nodes not configured for workload identity
      data:
        name: "{{ `{{ .name }}` }}"
        server: "{{ `{{ .server }}` }}"
        config: |
          {{ `{{ .config }}` }}
  dataFrom:
    - extract:
        key: argoCdBuidlkiteInfraCentral # multi-key gcp json secret
      